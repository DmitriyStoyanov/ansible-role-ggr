---
# This is an example playbook to execute Ansible tests.
- name: Verify
  hosts: all
  become: true
  tasks:
    - name: Configure Go Grid Router quota
      copy:
        dest: '/home/ggr/go-grid-router/quota'
        src: 'ggr-config-example.xml'
        mode: 0664
        owner: 'ggr'
        group: 'ggr'

    - name: Reset failed services
      command: systemctl reset-failed {{ item.key }}
      loop:
        - key: ggr.service
        - key: ggr-ui.service
        - key: selenoid-ui.service
      become: true

    - name: Restart selenoid-ui.service
      systemd:
        state: restarted
        name: "{{ item.key }}"
      loop:
        - key: ggr
        - key: ggr-ui
        - key: selenoid-ui
      become: true

    - name: Populate service facts
      service_facts:

    - name: Assert that ggr services are running
      assert:
        that:
          - "'running' in ansible_facts.services['ggr.service'].state"
          - "'running' in ansible_facts.services['ggr-ui.service'].state"
